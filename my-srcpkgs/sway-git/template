# Template file for 'sway-git'
build_options="elogind"
build_style=meson
conf_files="/etc/sway/config"
conflicts=sway
depends="swaybg xorg-server-xwayland $(vopt_if elogind "elogind")"
desc_option_elogind="Uses elogind instead of setuid for privilege escalation"
homepage="https://swaywm.org"
hostmakedepends="pkg-config scdoc git"
license="MIT"
maintainer="Orphaned <orphan@voidlinux.org>"
my_field_repo=git://github.com/swaywm/sway.git
my_field_ignore=1
pkgname=sway-git
provides=sway-0_1
revision=1
short_desc="Tiling Wayland compositor compatible with i3"
version=0

# MESON
# meson
#
# NOT FOUND
# cmake
# json-c-devel

#makedepends="json-c-devel pcre-devel wayland-protocols libxkbcommon-devel cairo-devel pango-devel cmake gdk-pixbuf-devel libevdev-devel libinput-devel wlroots-devel"
makedepends="wlroots-devel wayland-devel wayland-protocols pcre-devel
 json-c-devel pango-devel cairo-devel gdk-pixbuf-devel"

sway-git_package() {
    true
}

do_fetch() {
    git clone $my_field_repo ${pkgname}-${version}
}

post_patch() {
    vsed -e 's/werror=true/werror=false/g' -i meson.build
}

post_install() {
    vlicense LICENSE
    if [ -z "$build_option_elogind" ]; then
        # must be setuid without logind!
        chmod u+s ${DESTDIR}/usr/bin/sway
    fi
}
