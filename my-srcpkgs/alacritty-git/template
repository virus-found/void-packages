# Template file for 'alacritty'
pkgname=alacritty-git
version=3e867a0
revision=1
build_style=cargo
hostmakedepends="pkg-config python3"
makedepends="freetype-devel fontconfig-devel libxcb-devel"
depends="libXi libXxf86vm ncurses alacritty-terminfo-git-${version}_${revision}"
short_desc="Cross-platform, GPU-accelerated terminal emulator"
maintainer="Andrea Brancaleoni <abc@pompel.me>"
license="Apache-2.0"
homepage="https://github.com/alacritty/alacritty"
_my_field_repo=git://github.com/alacritty/alacritty
configure_args="--no-default-features --features=wayland"
conflicts="alacritty>=0"
hostmakedepends+=" git"
replaces="alacritty>=0"

do_build() {
	cargo build --manifest-path alacritty/Cargo.toml --release --target ${RUST_TARGET} ${configure_args}
}

do_install() {
	cargo install --path alacritty --target ${RUST_TARGET} --root="${DESTDIR}/usr" --locked ${configure_args}
	rm "${DESTDIR}"/usr/.crates.toml
}

post_install() {
	vinstall extra/linux/Alacritty.desktop 644 usr/share/applications
	vinstall extra/logo/alacritty-term.svg 644 usr/share/pixmaps Alacritty.svg
	vinstall extra/completions/alacritty.bash 644 usr/share/bash-completion/completions alacritty
	vinstall extra/completions/_alacritty 644 usr/share/zsh/site-functions
	vinstall extra/completions/alacritty.fish 644 usr/share/fish/vendor_completions.d
	vinstall extra/alacritty.info 644 usr/share/terminfo/a
	vman extra/alacritty.man alacritty.1
	vinstall alacritty.yml 644 usr/share/examples/alacritty
}

alacritty-terminfo-git_package() {
	short_desc+=" - terminfo data"
	conflicts="alacritty-terminfo>=0"
	replaces="alacritty-terminfo>=0"
	pkg_install() {
		vmove usr/share/terminfo
	}
}
