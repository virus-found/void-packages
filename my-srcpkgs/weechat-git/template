# Template file for 'weechat-git'
_my_field_repo=git://github.com/weechat/weechat.git
_my_field_skip_version=e11075e
build_style=cmake
configure_args="
    -DPYTHON_EXECUTABLE=/usr/bin/python3
    -DPYTHON_LIBRARY=${XBPS_CROSS_BASE}/usr/lib/libpython3.so

    -DENABLE_HEADLESS=OFF -DENABLE_NLS=ON -DENABLE_ALIAS=ON
    -DENABLE_EXEC=OFF -DENABLE_LOGGER=OFF -DENABLE_RELAY=OFF
    -DENABLE_SCRIPT=ON -DENABLE_SCRIPTS=ON -DENABLE_PERL=ON
    -DENABLE_PYTHON=ON -DENABLE_PYTHON2=OFF -DENABLE_RUBY=OFF
    -DENABLE_LUA=OFF -DENABLE_TCL=OFF -DENABLE_GUILE=OFF
    -DENABLE_JAVASCRIPT=OFF -DENABLE_PHP=OFF -DENABLE_SPELL=OFF
    -DENABLE_ENCHANT=OFF -DENABLE_TRIGGER=OFF -DENABLE_XFER=OFF
    -DENABLE_MAN=OFF -DENABLE_DOC=OFF -DENABLE_TESTS=OFF
    -DENABLE_CODE_COVERAGE=OFF
"
conflicts=weechat
depends="ca-certificates"
homepage="https://www.weechat.org"
hostmakedepends="git libgcrypt-devel pkg-config python3"
lib32disabled=yes
license="GPL-3.0-or-later"
maintainer="Orphaned <orphan@voidlinux.org>"
makedepends="gnutls-devel libcurl-devel python3-devel perl"
pkgname=weechat-git
provides=weechat-0_1
revision=1
short_desc="Fast, light and extensible IRC client"
version=c6e9e18

weechat-git_package() {
    true
}

do_fetch() {
    git clone $_my_field_repo ${pkgname}-${version}
}

if [ "$CROSS_BUILD" ]
then
    _perlpath="${XBPS_CROSS_BASE}/usr/lib/perl5/core_perl/CORE"
    configure_args+="
        -DPERL_FOUND=1
        -DPERL_EXECUTABLE=0
        -DPERL_INCLUDE_PATH=$_perlpath
        -DPERL_LIBRARY=${XBPS_CROSS_BASE}/usr/lib/libperl.so
        -DPERL_CFLAGS=-I$_perlpath
        -DPERL_LFLAGS=-L$_perlpath
    "
fi

post_extract() {
    vsed -i '/pkg_search_module/s/ruby-2.2/ruby-2.9 ruby-2.8 ruby-2.7 ruby-2.6 ruby-2.5 ruby-2.4 ruby-2.3 &/' cmake/FindRuby.cmake
}

weechat-perl-git_package() {
    conflicts=weechat-perl
    depends="${sourcepkg}>=${version}_${revision}"
    lib32disabled=yes
    provides=weechat-perl-0_1
    short_desc+=" - perl plugin"

    pkg_install() {
        vmove usr/lib/weechat/plugins/perl.so
    }
}

weechat-python-git_package() {
    conflicts=weechat-python
    depends="${sourcepkg}>=${version}_${revision}"
    lib32disabled=yes
    provides=weechat-python-0_1
    short_desc+=" - python plugin"

    pkg_install() {
        vmove usr/lib/weechat/plugins/python.so
    }
}

weechat-devel-git_package() {
    conflicts=weechat-devel
    depends="${sourcepkg}>=${version}_${revision} ncurses-devel"
    lib32disabled=yes
    provides=weechat-devel-0_1
    short_desc+=" - development package"

    pkg_install() {
        vmove usr/include
        vmove usr/lib/pkgconfig
    }
}
