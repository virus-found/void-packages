-pkgname=alacritty
-build_wrksrc="${pkgname}"
+pkgname=alacritty-git
-depends="libXi libXxf86vm ncurses alacritty-terminfo-${version}_${revision}"
+depends="libXi libXxf86vm ncurses alacritty-terminfo-git-${version}_${revision}"
-changelog="https://raw.githubusercontent.com/alacritty/alacritty/master/CHANGELOG.md"
+_my_field_repo=git://github.com/alacritty/alacritty
+configure_args="--no-default-features --features=wayland"
+conflicts="alacritty>=0"
+hostmakedepends+=" git"
+replaces="alacritty>=0"
-case "$XBPS_TARGET_MACHINE" in
-	ppc64*) ;;
-	ppc*) broken="ftbfs: thread 'main' panicked at 'slice index starts at 4289555962 but ends at 114', /builddir/rustc-1.46.0-src/src/libstd/io/mod.rs:396:27";;
-esac
+do_build() {
+	cargo build --manifest-path alacritty/Cargo.toml --release --target ${RUST_TARGET} ${configure_args}
+}
+
+do_install() {
+	cargo install --path alacritty --target ${RUST_TARGET} --root="${DESTDIR}/usr" --locked ${configure_args}
+	rm "${DESTDIR}"/usr/.crates.toml
+}
-	vinstall ../extra/linux/Alacritty.desktop 644 usr/share/applications
-	vinstall ../extra/logo/alacritty-term.svg 644 usr/share/pixmaps Alacritty.svg
-	vinstall ../extra/completions/alacritty.bash 644 usr/share/bash-completion/completions alacritty
-	vinstall ../extra/completions/_alacritty 644 usr/share/zsh/site-functions
-	vinstall ../extra/completions/alacritty.fish 644 usr/share/fish/vendor_completions.d
-	vinstall ../extra/alacritty.info 644 usr/share/terminfo/a
-	vman ../extra/alacritty.man alacritty.1
-	vsconf ../alacritty.yml
+	vinstall extra/linux/Alacritty.desktop 644 usr/share/applications
+	vinstall extra/logo/alacritty-term.svg 644 usr/share/pixmaps Alacritty.svg
+	vinstall extra/completions/alacritty.bash 644 usr/share/bash-completion/completions alacritty
+	vinstall extra/completions/_alacritty 644 usr/share/zsh/site-functions
+	vinstall extra/completions/alacritty.fish 644 usr/share/fish/vendor_completions.d
+	vinstall extra/alacritty.info 644 usr/share/terminfo/a
+	vman extra/alacritty.man alacritty.1
+	vinstall alacritty.yml 644 usr/share/examples/alacritty
-alacritty-terminfo_package() {
+alacritty-terminfo-git_package() {
+	conflicts="alacritty-terminfo>=0"
+	replaces="alacritty-terminfo>=0"
